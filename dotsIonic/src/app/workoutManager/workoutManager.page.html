<ion-header>
  <ion-toolbar>
    <ion-title>Workout manager</ion-title>

  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-card >
    <ion-card-header *ngIf="current.ExerciseIndex != null" class="ion-text-center">

      <ion-segment>
        <ion-segment-button (click)="terminateWorkout()">
          <ion-icon name="square"></ion-icon>
        </ion-segment-button>
        <ion-segment-button disabled>
          <ion-label style="font-size: 1.2rem">
            {{ timerService.currentDate * 1000 - timerService.startDate * 1000 | date:'HH:mm:ss':'UTC' }}
          </ion-label>
        </ion-segment-button>
        <ion-segment-button
          *ngIf="!controls.IsPaused; else playButton"
          (click)="pauseWorkout()">
          <ion-icon name="pause"></ion-icon>
        </ion-segment-button>
        <ng-template #playButton>
          <ion-segment-button (click)="playWorkout()">
            <ion-icon name="play" color="primary"></ion-icon>
          </ion-segment-button>
        </ng-template>
      </ion-segment>

      <ion-item *ngIf="controls.IsABreak == true">
        <ion-grid class="ion-text-center">
          <ion-row>
            <ion-col>
              <h1>Take a break </h1>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              Next exercise: {{ sheetExercises.Structure[current.ExerciseIndex + 1].Title }} in
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <h1>{{ current.BreakSecondsLeft }}</h1>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>

      <ion-item *ngIf="controls.IsABreak == false || IsPaused == false">

        <ion-grid class="ion-text-center">
          <ion-row>
            <ion-col>
              <h1>{{ sheetExercises.Structure[current.ExerciseIndex].Title }}</h1>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12" size-sm> Your result: </ion-col>
            <ion-col size="12" size-sm>
              <ion-input *ngIf="sheetExercises.Structure[current.ExerciseIndex].Type != 'Bool'; else checkbox"
                [type]="sheetExercises.Structure[current.ExerciseIndex].Type"
                size="12" size-sm
                [value]="sheetExercises.Structure[current.ExerciseIndex].Goal"
                [(ngModel)]="current.InputValue">
              </ion-input>

              <ng-template #checkbox>
                <ion-checkbox [(ngModel)]='current.InputValue' style='margin-right: 1rem'></ion-checkbox>
              </ng-template>
            </ion-col>
            <ion-col size="12" size-sm>
              <ion-chip [color]="
                current.InputValue < sheetExercises.Structure[current.ExerciseIndex].Goal * 2/5 ? 'danger' :
                current.InputValue < sheetExercises.Structure[current.ExerciseIndex].Goal * 1/2 ? 'warning' :
                'primary'
                ">
                <ion-label *ngIf="sheetExercises.Structure[current.ExerciseIndex].Type == 'Number'">
                  {{ current.InputValue * 100 / sheetExercises.Structure[current.ExerciseIndex].Goal | number: '1.0-0' }}
                  % of your goal ( {{ sheetExercises.Structure[current.ExerciseIndex].Goal }} )
                </ion-label>
                <ion-label *ngIf="sheetExercises.Structure[current.ExerciseIndex].Type == 'Time'">
                  {{ timeAndDateService.calculateTimeRatio(current.InputValue, sheetExercises.Structure[current.ExerciseIndex].Goal) }}
                  % of your goal ( {{ sheetExercises.Structure[current.ExerciseIndex].Goal }} )
                </ion-label>
              </ion-chip>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>

    </ion-card-header>

    <ion-card-content>

        <ion-item color="primary">  Exercises </ion-item>

        <ion-grid>
          <ion-row>
            <ion-col> Exercise </ion-col>
            <ion-col
              *ngIf="results.length > 0"
              style="max-width: 80px; text-align: center"> Result </ion-col>
            <ion-col
              style="max-width: 80px; text-align: center"> Goal </ion-col>
          </ion-row>
          <ion-row
            *ngFor="let exercise of sheetExercises.Structure; let i = index">
            <ion-col>
              <ion-icon *ngIf="i == current.ExerciseIndex" name="play"></ion-icon>
              {{ exercise.Title }}
            </ion-col>
            <ion-col
              *ngIf="results[i] != null"
              style="max-width: 80px; text-align: center">{{ results[i] }}</ion-col>
            <ion-col
              style="max-width: 80px"
              class="ion-text-center">{{ exercise.Goal }}</ion-col>
          </ion-row>
        </ion-grid>
    </ion-card-content>
  </ion-card>


</ion-content>

<ion-footer style="padding: 0.5rem">
  <ion-button expand="block"
    (click)="startWorkout()"
    *ngIf="current.ExerciseIndex == null">Start</ion-button>

  <ion-button expand="block"
    *ngIf="current.ExerciseIndex != null && current.ExerciseIndex < exerciseNumber - 1"
    [disabled]="controls.IsABreak"
    (click)="markAsCompleted()">Mark as completed</ion-button>

  <ion-button expand="block"
    *ngIf="current.ExerciseIndex == exerciseNumber - 1"
    (click)="finish()">Finish</ion-button>

</ion-footer>
