
  <no-items-message 
    headerMessage="NoRecordsYet"
    buttonLabel="AddYourFirstRecord"
    (buttonClicked)="addRecord()"
    [color]="color"
    *ngIf="dataTableService.allRecords.length == 0">
  </no-items-message>

  <div *ngIf="dataTableService.allRecords.length > 0">

    <ion-card>

      <ion-grid>

        <ion-row>

          <ion-col sizeLg="4" sizeMd="6" sizeXs="12">
            <h1> {{ 'Last5EntryStats' | translate }} </h1>

            <div *ngFor="let category of resultsCategories">

              <ion-card *ngIf="dataTableService.resultsAnalysis[category].length > 0">

                <ion-card-header 
                  style="display: flex;"
                  (click)="toggleAnalysisDetails(category)"
                  [color]="categoryColors[category]">

                  <ion-label style="flex-grow: 1;">
                    {{ 'exercisesWithResults.' + category | translate }}: 
                    {{ dataTableService.resultsAnalysis[category].length }} {{ 'exercises' | translate }}
                  </ion-label>

                  <ion-button fill="clear" color="light">
                    <ion-icon name="arrow-dropdown-circle" *ngIf="!showAnalysisDetails[category]"></ion-icon>
                    <ion-icon name="arrow-dropup-circle" *ngIf="showAnalysisDetails[category]"></ion-icon>
                  </ion-button>

                </ion-card-header>

                <ion-card-content *ngIf="showAnalysisDetails[category]">

                  <div *ngFor="let param of dataTableService.resultsAnalysis[category]">
                    {{ param.Title }} ({{ param.AveragePercentage | number:'1.0-0' }}%)
                  </div>

                </ion-card-content>

              </ion-card>

            </div>

          </ion-col>

          <ion-col>
            <ion-button (click)="editParams()" size="small">
              <ion-icon name="create" color="light"></ion-icon>
            </ion-button>
          </ion-col>

        </ion-row>

      </ion-grid>


    </ion-card>
       
    <ion-toolbar>
      <ion-item>
        <ion-label>
          {{ 'ShowRecordsForPeriod' | translate }}: </ion-label>
        <ion-select
          placeholder="Select period"
          multiple
          [(ngModel)]="dataTableService.showingPeriod"
          (ionChange)="dataTableService.setPeriod($event, false)">
          <ion-select-option
            *ngFor="let month of dataTableService.months"
            [value]="month">
              {{ month }}
          </ion-select-option>
        </ion-select>
      </ion-item>
    </ion-toolbar>

    <div style="position: relative;">
  
      <chart-legend
      *ngIf="dataTableService.showMode == 'chart'"
      [color]="color"
      [legendTitle]="legendTitle"
      [data]="dataTableService.params"
      [goals]="dataTableService.goals"
      [resultsAnalysis]="dataTableService.resultsAnalysis"
      [colorScheme]="chartService.colorScheme.domain"
      (editParamsButtonClicked)="editParams()"
    ></chart-legend>
    
      <div *ngIf="dataTableService.showMode == 'chart' && dataTableService.showingRecords.length > 0" 
        style="width: 100%; height: 400px; overflow-x: auto; overflow-y: hidden; position: relative;">

        <div style="width: 100%; height: 400px" [style.minWidth.px]="chartService.chartWidth">

          <ngx-charts-line-chart
            view=""
            [results]="chartService.chartData"
            [scheme]="chartService.colorScheme"
            schemeType="ordinal"
            [gradient]="false"
            showDataLabel="true"
            [xAxis]="true"
            [yAxis]="true"
            showXAxisLabel="false"
            showYAxisLabel="false">
            
            <ng-template #tooltipTemplate let-model="model">
              <chart-tooltip [data]="model"></chart-tooltip>
            </ng-template>

            <ng-template #seriesTooltipTemplate let-model="model">
              <chart-tooltip [data]="model"></chart-tooltip>
            </ng-template>
          </ngx-charts-line-chart>

        </div>

      </div>

    </div>

    <ion-grid *ngIf="dataTableService.showMode == 'table' && dataTableService.showingRecords.length > 0">

      <ion-row nowrap>
        <ion-col style="width: 130px">
          
          <table style="width: 130px">

            <tr>
              <th>
                <div class="table-header color-{{color}}-light"
                title='Date'
                (click)="dataTableService.sortByDate()">
                  {{ 'Date' | translate }}
                  <ion-icon name="arrow-dropup" *ngIf="dataTableService.sortedByDate == 'asc'; else arrowDown"></ion-icon>
                  <ng-template #arrowDown><ion-icon name="arrow-dropdown"></ion-icon></ng-template>
                </div>
              </th>
            </tr>

            <tr *ngFor="let record of dataTableService.showingRecords">
              <td>
                <ion-item lines="none">

                  <ion-button 
                    (click)="showRecordOptions(record)" fill="clear" class="showRecordOptionsButton">
                    <ion-icon name="more" style="font-size: 1.5rem" class="icon-{{color}}"></ion-icon>
                  </ion-button>

                  {{ record.Date | date : 'dd.MM.yy' }}
                </ion-item>
              </td>
            </tr>

          </table>

        </ion-col>

        <ion-col style="width: calc(100% - 130px);">

          <div style="overflow-x: auto;">

            <table style="width: 100%">
              
              <tr>
                <th 
                  style="min-width: 120px;"
                  *ngFor="let param of dataTableService.params; let i = index">
                  <div 
                    class="table-header color-{{color}}-light"
                    [title]="param.Title"
                    (click)="dataTableService.sortCol(param, i)">
                    <ion-label>
                      <ion-label *ngIf="param.Title.length > 8; else fullTitle"> 
                        {{ param.Title | translate | slice:0:8 }}...</ion-label>
                      <ng-template #fullTitle> {{ param.Title  | translate }} </ng-template>
                    </ion-label>
                    <ion-icon name="arrow-dropup" *ngIf="param.sorted == 'asc'; else arrowDown"></ion-icon>
                    <ng-template #arrowDown><ion-icon name="arrow-dropdown"></ion-icon></ng-template>
                  </div>
                </th>
              </tr>

              <tr class="value-row" *ngFor="let record of dataTableService.showingRecords">

                <td 
                  class="value-cell"
                  *ngFor="let param of dataTableService.params; let j = index"
                  [title]="param.Title">

                  <ion-item lines="none">
                    
                    <ion-label *ngIf="param.Type != 'Bool'; else showTick">
                      {{ record.Values[j] }}
                    </ion-label>
    
                    <ng-template #showTick>
                      <ion-icon name="checkmark-circle" color="success" *ngIf="record.Values[j] == true"></ion-icon>
                      <ion-icon name="close-circle" color="danger" *ngIf="record.Values[j] == false"></ion-icon>
                    </ng-template>
    
                    <ion-label 
                      *ngIf="param.Unit && record.Values[j] != null"
                      style="margin-left: 2px">
                      {{ param.Unit | translate }}
                    </ion-label>
    
                    <percentage-chip
                      *ngIf="record.Values[j] != null && param.Type != 'Bool'"
                      [percentage]="record.PercentageOfGoal[j]">
                    </percentage-chip>
    
                  </ion-item>

                </td>

              </tr>

            </table>

          </div>
        
        </ion-col>

      </ion-row>

    </ion-grid>

  </div>


  <ion-fab 
    *ngIf="dataTableService.params.length != 0"
    vertical="bottom" 
    horizontal="end" 
    style="position: fixed;"
    slot="fixed">
    <ion-fab-button 
      (click)="addRecord()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
